<div class="table-responsive mb-5 ">
  <h2>Empréstimo de livro</h2>

  <form (ngSubmit)="createLending()">
    <div class="form-group">
      <label for="userSelect">Selecione o Usuário:</label>
      <select id="userSelect" class="form-control" [(ngModel)]="selectedUserId" name="userSelect" required>
        @for (user of users; track user.id) {
          <option [value]="user.id">{{ user.name }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="bookSelect">Selecione o Livro:</label>
      <select id="bookSelect" class="form-control" [(ngModel)]="selectedBookId" name="bookSelect" required>
        @for (book of booksLending; track book.id) {
          <option [disabled]="users.length == 0" [value]="book.id">{{ book.title }}</option>
        }
      </select>
    </div>

    <button [disabled]="users.length == 0 || booksLending.length == 0" type="submit" class="btn btn-primary mt-3">Confirmar Empréstimo</button>
  </form>
</div>


<hr>


<div class="table-responsive mt-5">
  <table class="table table-bordered table-striped">
    <thead class="thead-light">
    <tr>
      <th>Usuário</th>
      <th>Livro</th>
      <th>Data do Empréstimo</th>
      <th>Data de Devolução</th>
      <th>Status</th>
      <th>Ações</th>
    </tr>
    </thead>
    <tbody>
      @if (loans && loans.page.totalElements && loans.page.totalElements > 0) {
        @for (loan of loans._embedded.loanResponseList | paginate:
          {itemsPerPage: pageSize, currentPage: page, totalItems: count}; track loan.id) {
          <tr>
            <td>{{ loan.user.name }}</td>
            <td>{{ loan.book.title }}</td>
            <td>{{ loan.loanDate }}</td>
            <td>{{ loan.returnDate }}</td>
            <td>{{ loan.status }}</td>
            <td>
              <button type="button" class="btn btn-secondary" (click)="editLending(loan)">
                <i class="fas fa-edit"></i> Editar
              </button>
            </td>
          </tr>
        }
      } @else {
        <tr>
          <td colspan="3" class="text-center">Nenhum empréstimo encontrado.</td>
        </tr>
      }
    </tbody>
  </table>
  <pagination-controls (pageChange)="pageChangeEvent($event)" class="mt-3"></pagination-controls>
</div>


<ngx-spinner size="medium" type="ball-clip-rotate" [fullScreen]="true">
  <p style="color: white"></p>
</ngx-spinner>

